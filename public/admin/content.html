<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Content Editor - Import From Nepal</title>
    <script defer src="https://cloud.umami.is/script.js"
        data-website-id="ac82397e-0bc4-4fe6-bac5-42f6b962b391"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .premium-gradient {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        .gold-gradient {
            background: linear-gradient(135deg, #D97706 0%, #F59E0B 100%);
        }

        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
        }

        .section-card {
            transition: all 0.3s ease;
        }

        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .form-input {
            transition: all 0.2s ease;
        }

        .form-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(217, 119, 6, 0.2);
        }

        .preview-card {
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .preview-card.editing {
            border-color: #D97706;
            background: rgba(217, 119, 6, 0.05);
        }

        .tab-button {
            transition: all 0.2s ease;
        }

        .tab-button.active {
            background: #D97706;
            color: white;
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-stone-50 to-amber-50 min-h-screen">
    <!-- Header -->
    <nav class="premium-gradient text-white shadow-2xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 gold-gradient rounded-lg flex items-center justify-center shadow-lg">
                        <span class="text-2xl">üé®</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-light tracking-tight">Website Editor</h1>
                        <p class="text-xs text-gray-400 font-light">Edit your homepage content</p>
                    </div>
                </div>
                <div class="flex items-center gap-6">
                    <a href="../index.html" target="_blank" class="text-gray-300 hover:text-white transition flex items-center gap-2">
                        <span>üëÅÔ∏è</span> View Site
                    </a>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-5 py-2.5 rounded-lg transition flex items-center gap-2">
                        <span>üö™</span> Sign Out
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <!-- Status Messages -->
        <div id="success-message" class="hidden bg-green-50 border-l-4 border-green-500 text-green-800 px-6 py-4 rounded-lg mb-6 flex items-center gap-3">
            <span class="text-2xl">‚úÖ</span>
            <div>
                <div class="font-semibold">Changes Saved!</div>
                <div class="text-sm">Your website content has been updated successfully.</div>
            </div>
        </div>

        <div id="error-message" class="hidden bg-red-50 border-l-4 border-red-500 text-red-800 px-6 py-4 rounded-lg mb-6 flex items-center gap-3">
            <span class="text-2xl">‚ùå</span>
            <div>
                <div class="font-semibold">Error Saving Changes</div>
                <div class="text-sm" id="error-text">Please try again.</div>
            </div>
        </div>

        <!-- Main Editor Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Sidebar - Section Navigation -->
            <div class="lg:col-span-1">
                <div class="glass rounded-2xl p-6 shadow-lg sticky top-24">
                    <h2 class="text-xl font-bold mb-6 text-gray-900">üìù Edit Sections</h2>

                    <div class="space-y-3">
                        <button onclick="selectSection('hero')" id="tab-hero" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">Hero Banner</div>
                            <div class="text-sm text-gray-600">Main headline & description</div>
                        </button>

                        <button onclick="selectSection('featured')" id="tab-featured" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">Featured Products</div>
                            <div class="text-sm text-gray-600">Showcase your top pieces</div>
                        </button>

                        <button onclick="selectSection('why-choose-us')" id="tab-why-choose-us" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">Why Choose Us</div>
                            <div class="text-sm text-gray-600">Trust indicators & benefits</div>
                        </button>

                        <button onclick="selectSection('stats')" id="tab-stats" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">Impact Numbers</div>
                            <div class="text-sm text-gray-600">Statistics & achievements</div>
                        </button>

                        <button onclick="selectSection('testimonials')" id="tab-testimonials" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">Customer Reviews</div>
                            <div class="text-sm text-gray-600">Testimonials & feedback</div>
                        </button>

                        <button onclick="selectSection('blog')" id="tab-blog" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">Blog Stories</div>
                            <div class="text-sm text-gray-600">Latest articles & updates</div>
                        </button>

                        <button onclick="selectSection('testimonials')" id="tab-testimonials" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">Testimonials</div>
                            <div class="text-sm text-gray-600">Customer reviews & feedback</div>
                        </button>

                        <button onclick="selectSection('seo')" id="tab-seo" class="tab-button w-full text-left px-4 py-3 rounded-xl border-2 border-gray-200 hover:border-amber-300 transition">
                            <div class="font-semibold text-gray-900">SEO Settings</div>
                            <div class="text-sm text-gray-600">Meta tags & search optimization</div>
                        </button>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <div class="flex gap-4 justify-center flex-wrap">
                            <button onclick="testLocalStorage()" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-medium">
                                üß™ Test Storage
                            </button>
                            <button onclick="clearLocalStorage()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium">
                                üóëÔ∏è Clear Data
                            </button>
                            <button onclick="openHomepage()" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium">
                                üè† Test Homepage
                            </button>
                            <button onclick="runDirectTest()" class="px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-medium">
                                ‚ö° Direct Test
                            </button>
                        </div>
                        <div class="text-center mt-4">
                            <div class="text-sm text-gray-600 mb-2">Need Help?</div>
                            <a href="mailto:support@importfromnepal.com" class="text-amber-700 hover:text-amber-900 font-medium text-sm">
                                Contact Support ‚Üí
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Content Area -->
            <div class="lg:col-span-2">
                <!-- Editor Panel -->
                <div class="glass rounded-2xl shadow-lg mb-8">
                    <div class="p-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900" id="editor-title">Select a Section to Edit</h2>
                            <div class="flex gap-3">
                                <button id="preview-btn" onclick="togglePreview()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm font-medium">
                                    üëÅÔ∏è Preview
                                </button>
                                <button id="save-btn" onclick="saveChanges()" class="gold-gradient text-white px-6 py-2 rounded-lg font-medium shadow-md hover:shadow-lg transition">
                                    üíæ Save Changes
                                </button>
                            </div>
                        </div>

                        <!-- Editor Content -->
                        <div id="editor-content" class="space-y-6">
                            <div class="text-center py-12 text-gray-500">
                                <div class="text-6xl mb-4">üëÜ</div>
                                <p class="text-lg">Select a section from the sidebar to start editing</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Preview -->
                <div id="preview-panel" class="glass rounded-2xl shadow-lg hidden">
                    <div class="p-8">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-900">üì± Live Preview</h2>
                            <button onclick="togglePreview()" class="text-gray-500 hover:text-gray-700">
                                <span class="text-2xl">‚úï</span>
                            </button>
                        </div>

                        <div id="preview-content" class="bg-white rounded-xl p-6 border border-gray-200">
                            <p class="text-gray-600">Preview will appear here...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
                    <div>
                        <h1 class="text-2xl font-light tracking-tight">Content Management</h1>
                        <p class="text-xs text-gray-400 font-light">Manage website content</p>
                    </div>
                </div>
                <div class="flex items-center gap-6">
                    <a href="dashboard.html" class="text-gray-300 hover:text-white transition">Dashboard</a>
                    <a href="products.html" class="text-gray-300 hover:text-white transition">Products</a>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-5 py-2.5 rounded-lg transition">Sign Out</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-6 py-12">
        <!-- Messages -->
        <div id="success-message" class="hidden bg-green-50 border-l-4 border-green-500 text-green-800 px-6 py-4 rounded-lg mb-6"></div>
        <div id="error-message" class="hidden bg-red-50 border-l-4 border-red-500 text-red-800 px-6 py-4 rounded-lg mb-6"></div>

        <!-- Content Sections -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
            <div class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition">
                <h3 class="text-xl font-bold mb-4">Why Choose Us</h3>
                <p class="text-gray-600 mb-4">Manage the "Why Choose Us" section items</p>
                <button onclick="editWhyChooseUs()" class="gold-gradient text-white px-4 py-2 rounded-lg hover:shadow-lg transition">Edit Section</button>
            </div>

            <div class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition">
                <h3 class="text-xl font-bold mb-4">Impact Stats</h3>
                <p class="text-gray-600 mb-4">Update the statistics displayed on homepage</p>
                <button onclick="editStats()" class="gold-gradient text-white px-4 py-2 rounded-lg hover:shadow-lg transition">Edit Stats</button>
            </div>

            <div class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition">
                <h3 class="text-xl font-bold mb-4">Hero Section</h3>
                <p class="text-gray-600 mb-4">Modify the main hero banner content</p>
                <button onclick="editHero()" class="gold-gradient text-white px-4 py-2 rounded-lg hover:shadow-lg transition">Edit Hero</button>
            </div>

            <div class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition">
                <h3 class="text-xl font-bold mb-4">SEO Settings</h3>
                <p class="text-gray-600 mb-4">Update meta tags and SEO content</p>
                <button onclick="editSEO()" class="gold-gradient text-white px-4 py-2 rounded-lg hover:shadow-lg transition">Edit SEO</button>
            </div>

            <div class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition">
                <h3 class="text-xl font-bold mb-4">Social Media</h3>
                <p class="text-gray-600 mb-4">Update social media links</p>
                <button onclick="editSocial()" class="gold-gradient text-white px-4 py-2 rounded-lg hover:shadow-lg transition">Edit Links</button>
            </div>

            <div class="glass rounded-xl p-6 shadow-lg hover:shadow-xl transition">
                <h3 class="text-xl font-bold mb-4">Footer Content</h3>
                <p class="text-gray-600 mb-4">Modify footer text and links</p>
                <button onclick="editFooter()" class="gold-gradient text-white px-4 py-2 rounded-lg hover:shadow-lg transition">Edit Footer</button>
            </div>
        </div>

        <!-- Current Content Display -->
        <div class="glass rounded-xl p-8 shadow-lg">
            <h2 class="text-2xl font-bold mb-6">Current Content Preview</h2>
            <div id="content-preview" class="space-y-6">
                <p class="text-gray-600">Loading current content...</p>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="glass rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h2 id="modal-title" class="text-2xl font-bold mb-6">Edit Content</h2>

            <form id="content-form" class="space-y-4">
                <input type="hidden" id="content-section">

                <!-- Dynamic form fields will be inserted here -->

                <div class="flex gap-4 pt-4">
                    <button type="submit" class="flex-1 gold-gradient text-white py-3 rounded-xl font-semibold">Save Changes</button>
                    <button type="button" onclick="closeModal()" class="px-8 py-3 border-2 border-gray-300 rounded-xl hover:bg-gray-50">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/+esm'

        // Use environment variables or fallback
        const supabase = createClient(
            'https://tpvqolkzcbbzlqlzchwc.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRwdnFvbGt6Y2JiemxxbHpjaHdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYzNjA0MjgsImV4cCI6MjA4MTkzNjQyOH0.AU6ieHN1TSUHgSu7qfvkekvmMySDPJb2zOId4Oy7CeY'
        )

        let currentContent = {}
        let currentSection = null

        async function verifyAuth() {
            const { data: { session } } = await supabase.auth.getSession()
            if (!session) {
                window.location.href = 'login.html'
                return false
            }
            await loadCurrentContent()
            return true
        }

        async function loadCurrentContent() {
            try {
                // First try to load from Supabase
                const { data, error } = await supabase
                    .from('site_content')
                    .select('*')
                    .single()

                if (error && error.code !== 'PGRST116') {
                    // If table doesn't exist, fall back to localStorage
                    console.warn('Database not available, using localStorage:', error.message)
                    const localData = localStorage.getItem('site_content')
                    currentContent = localData ? JSON.parse(localData) : {}
                    return
                }

                currentContent = data?.content || {}
                console.log('Loaded content from database:', currentContent)
            } catch (error) {
                console.error('Error loading content:', error)
                // Fall back to localStorage
                const localData = localStorage.getItem('site_content')
                currentContent = localData ? JSON.parse(localData) : {}
                console.log('Loaded content from localStorage:', currentContent)
            }
        }

        window.selectSection = function(section) {
            currentSection = section

            // Update tab styling
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active')
                btn.classList.add('bg-white', 'text-gray-700')
            })
            document.getElementById(`tab-${section}`).classList.add('active')
            document.getElementById(`tab-${section}`).classList.remove('bg-white', 'text-gray-700')

            // Show appropriate editor
            showEditor(section)
        }

        function showEditor(section) {
            const editorContent = document.getElementById('editor-content')
            const editorTitle = document.getElementById('editor-title')

            switch(section) {
                case 'hero':
                    editorTitle.textContent = 'üéØ Edit Hero Banner'
                    editorContent.innerHTML = `
                        <div class="space-y-6">
                            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-blue-600">üí°</span>
                                    <span class="font-semibold text-blue-900">Tip</span>
                                </div>
                                <p class="text-blue-800 text-sm">This is the first thing visitors see. Make it compelling and authentic to your Nepalese heritage.</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Main Headline</label>
                                <textarea id="hero-title" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500 resize-none" rows="3" placeholder="Handcrafted in the Himalayas">${currentContent.hero?.title || 'Handcrafted in the Himalayas'}</textarea>
                                <p class="text-xs text-gray-500 mt-1">Keep it under 10 words for maximum impact</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Subtitle Description</label>
                                <textarea id="hero-subtitle" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500 resize-none" rows="4" placeholder="Authentic Nepalese crafts made by skilled artisans...">${currentContent.hero?.subtitle || 'Authentic Nepalese crafts made by skilled artisans using centuries-old traditions. Each piece tells a story of Himalayan craftsmanship and cultural heritage.'}</textarea>
                                <p class="text-xs text-gray-500 mt-1">Describe what makes your products special</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">Call-to-Action Button Text</label>
                                <input type="text" id="hero-button" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500" placeholder="Explore Collection" value="${currentContent.hero?.buttonText || 'Explore Collection'}">
                                <p class="text-xs text-gray-500 mt-1">What action do you want visitors to take?</p>
                            </div>
                        </div>
                    `
                    break

                case 'why-choose-us':
                    editorTitle.textContent = '‚ú® Edit Why Choose Us'
                    editorContent.innerHTML = `
                        <div class="space-y-6">
                            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-green-600">üéØ</span>
                                    <span class="font-semibold text-green-900">Goal</span>
                                </div>
                                <p class="text-green-800 text-sm">Show visitors why they should trust and choose your authentic Nepalese products.</p>
                            </div>

                            <div id="why-items" class="space-y-4">
                                <!-- Items will be loaded here -->
                            </div>

                            <button onclick="addWhyItem()" class="w-full py-3 border-2 border-dashed border-amber-300 rounded-xl text-amber-700 hover:bg-amber-50 transition font-medium">
                                ‚ûï Add New Benefit
                            </button>
                        </div>
                    `
                    loadWhyItems()
                    break

                case 'stats':
                    editorTitle.textContent = 'üìä Edit Impact Statistics'
                    editorContent.innerHTML = `
                        <div class="space-y-6">
                            <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-purple-600">üìà</span>
                                    <span class="font-semibold text-purple-900">Numbers Matter</span>
                                </div>
                                <p class="text-purple-800 text-sm">Show your achievements and build credibility with real numbers.</p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Happy Customers</label>
                                    <input type="number" id="stat-customers" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500" value="${currentContent.stats?.happyCustomers || '20'}">
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Products Exported</label>
                                    <input type="number" id="stat-products" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500" value="${currentContent.stats?.productsSold || '500'}">
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Years in Business</label>
                                    <input type="number" id="stat-years" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500" value="${currentContent.stats?.yearsInBusiness || '15'}">
                                </div>

                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Average Rating</label>
                                    <input type="text" id="stat-rating" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500" value="${currentContent.stats?.averageRating || '4.8'}">
                                </div>
                            </div>
                        </div>
                    `
                    break

                case 'seo':
                    editorTitle.textContent = 'üîç Edit SEO Settings'
                    editorContent.innerHTML = `
                        <div class="space-y-6">
                            <div class="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-indigo-600">üéØ</span>
                                    <span class="font-semibold text-indigo-900">Search Optimization</span>
                                </div>
                                <p class="text-indigo-800 text-sm">These settings help your website appear in search results.</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Page Title</label>
                                <input type="text" id="seo-title" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500" value="${currentContent.seo?.metaTitle || 'Import From Nepal - Authentic Handicrafts'}" maxlength="60">
                                <p class="text-xs text-gray-500 mt-1">Appears in browser tab and search results (max 60 characters)</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Meta Description</label>
                                <textarea id="seo-description" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500 resize-none" rows="3" maxlength="160">${currentContent.seo?.metaDescription || 'Authentic handcrafted treasures from Nepal. Shop statues, singing bowls, thangkas, and more directly from artisans in the Himalayas.'}</textarea>
                                <p class="text-xs text-gray-500 mt-1">Appears under your title in search results (max 160 characters)</p>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Keywords</label>
                                <input type="text" id="seo-keywords" class="form-input w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-amber-500" value="${currentContent.seo?.keywords || 'Nepal handicrafts, singing bowls, buddha statues, thangka painting, himalayan art, authentic nepal export'}" placeholder="keyword1, keyword2, keyword3">
                                <p class="text-xs text-gray-500 mt-1">Comma-separated keywords that describe your business</p>
                            </div>
                        </div>
                    `
                    break

                case 'testimonials':
                    editorTitle.textContent = 'üí¨ Edit Customer Testimonials'
                    editorContent.innerHTML = `
                        <div class="space-y-6">
                            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-yellow-600">‚≠ê</span>
                                    <span class="font-semibold text-yellow-900">Social Proof</span>
                                </div>
                                <p class="text-yellow-800 text-sm">Customer testimonials build trust. Only use real reviews from satisfied customers.</p>
                            </div>

                            <div id="testimonial-items" class="space-y-4">
                                <!-- Testimonials will be loaded here -->
                            </div>

                            <button onclick="addTestimonial()" class="w-full py-3 border-2 border-dashed border-amber-300 rounded-xl text-amber-700 hover:bg-amber-50 transition font-medium">
                                ‚ûï Add New Testimonial
                            </button>
                        </div>
                    `
                    loadTestimonials()
                    break

                case 'blog':
                    editorTitle.textContent = 'üìù Edit Blog Stories'
                    editorContent.innerHTML = `
                        <div class="space-y-6">
                            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-blue-600">üìñ</span>
                                    <span class="font-semibold text-blue-900">Storytelling</span>
                                </div>
                                <p class="text-blue-800 text-sm">Share stories about Nepalese craftsmanship, artisan journeys, and cultural heritage.</p>
                            </div>

                            <div id="blog-items" class="space-y-4">
                                <!-- Blog posts will be loaded here -->
                            </div>

                            <button onclick="addBlogPost()" class="w-full py-3 border-2 border-dashed border-amber-300 rounded-xl text-amber-700 hover:bg-amber-50 transition font-medium">
                                ‚ûï Add New Blog Post
                            </button>
                        </div>
                    `
                    loadBlogPosts()
                    break
            }
        }

        function loadWhyItems() {
            const container = document.getElementById('why-items')
            const items = currentContent.whyChooseUs?.items || [
                { icon: '‚ú®', title: 'Authentic Heritage', description: 'Every artifact is verified for its cultural authenticity and handcrafted origin by master artisans.' },
                { icon: 'ü§ù', title: 'Fair Trade Ethics', description: 'We bypass middlemen to ensure that artisans receive the majority of the profits for their devotion.' },
                { icon: 'üåé', title: 'Global Reach', description: 'Museum-grade packaging and reliable worldwide delivery through our trusted logistics partners.' }
            ]

            container.innerHTML = items.map((item, index) => `
                <div class="glass rounded-xl p-6 border-2 border-gray-100">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">${item.icon}</span>
                            <input type="text" class="font-semibold text-gray-900 bg-transparent border-none outline-none" value="${item.title}" onchange="updateWhyItem(${index}, 'title', this.value)">
                        </div>
                        <button onclick="removeWhyItem(${index})" class="text-red-500 hover:text-red-700">
                            <span class="text-xl">üóëÔ∏è</span>
                        </button>
                    </div>
                    <textarea class="w-full px-3 py-2 border border-gray-200 rounded-lg resize-none text-sm" rows="3" onchange="updateWhyItem(${index}, 'description', this.value)">${item.description}</textarea>
                    <div class="mt-3">
                        <label class="text-xs text-gray-600">Icon:</label>
                        <input type="text" class="ml-2 px-2 py-1 border border-gray-200 rounded text-sm w-12" value="${item.icon}" onchange="updateWhyItem(${index}, 'icon', this.value)">
                    </div>
                </div>
            `).join('')
        }

        window.addWhyItem = function() {
            const items = currentContent.whyChooseUs?.items || []
            items.push({ icon: '‚≠ê', title: 'New Benefit', description: 'Describe your unique selling point here.' })
            if (!currentContent.whyChooseUs) currentContent.whyChooseUs = {}
            currentContent.whyChooseUs.items = items
            loadWhyItems()
        }

        window.updateWhyItem = function(index, field, value) {
            if (!currentContent.whyChooseUs) currentContent.whyChooseUs = {}
            if (!currentContent.whyChooseUs.items) currentContent.whyChooseUs.items = []
            currentContent.whyChooseUs.items[index][field] = value
        }

        window.removeWhyItem = function(index) {
            if (!currentContent.whyChooseUs?.items) return
            currentContent.whyChooseUs.items.splice(index, 1)
            loadWhyItems()
        }

        function loadTestimonials() {
            const container = document.getElementById('testimonial-items')
            const testimonials = currentContent.testimonials || [
                { customerName: 'Sarah Johnson', reviewText: 'The attention to detail in the Thangka painting I received is breathtaking. A true masterpiece that radiates spiritual energy.', rating: 5 },
                { customerName: 'Michael Chen', reviewText: 'Exceptional service and museum-grade packaging. The singing bowl\'s resonance is pure and healing. Truly high-quality artifacts.', rating: 5 }
            ]

            container.innerHTML = testimonials.map((testimonial, index) => `
                <div class="glass rounded-xl p-6 border-2 border-gray-100">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">üë§</span>
                            <input type="text" class="font-semibold text-gray-900 bg-transparent border-none outline-none" value="${testimonial.customerName}" onchange="updateTestimonial(${index}, 'customerName', this.value)">
                        </div>
                        <button onclick="removeTestimonial(${index})" class="text-red-500 hover:text-red-700">
                            <span class="text-xl">üóëÔ∏è</span>
                        </button>
                    </div>
                    <textarea class="w-full px-3 py-2 border border-gray-200 rounded-lg resize-none text-sm mb-3" rows="3" onchange="updateTestimonial(${index}, 'reviewText', this.value)">${testimonial.reviewText}</textarea>
                    <div class="flex items-center gap-2">
                        <label class="text-xs text-gray-600">Rating:</label>
                        <select onchange="updateTestimonial(${index}, 'rating', parseInt(this.value))" class="px-2 py-1 border border-gray-200 rounded text-sm">
                            <option value="5" ${testimonial.rating === 5 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5)</option>
                            <option value="4" ${testimonial.rating === 4 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê‚≠ê (4)</option>
                            <option value="3" ${testimonial.rating === 3 ? 'selected' : ''}>‚≠ê‚≠ê‚≠ê (3)</option>
                        </select>
                    </div>
                </div>
            `).join('')
        }

        function loadBlogPosts() {
            const container = document.getElementById('blog-items')
            const blogPosts = currentContent.blogStories || [
                { title: 'The Resonance of Seven Metals: Singing Bowl Secrets', description: 'Discover the ancient metallurgical secrets behind the healing vibrations of Himalayan singing bowls.', category: 'Tradition' },
                { title: 'Preserving Heritage: The Copper Smiths of Patan', description: 'Meet the families who have perfected the art of copper sculpture over ten generations in Nepal.', category: 'Artisans' }
            ]

            container.innerHTML = blogPosts.map((post, index) => `
                <div class="glass rounded-xl p-6 border-2 border-gray-100">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3 flex-1">
                            <span class="text-2xl">üìù</span>
                            <input type="text" class="font-semibold text-gray-900 bg-transparent border-none outline-none flex-1" value="${post.title}" onchange="updateBlogPost(${index}, 'title', this.value)">
                        </div>
                        <button onclick="removeBlogPost(${index})" class="text-red-500 hover:text-red-700 ml-2">
                            <span class="text-xl">üóëÔ∏è</span>
                        </button>
                    </div>
                    <textarea class="w-full px-3 py-2 border border-gray-200 rounded-lg resize-none text-sm mb-3" rows="2" onchange="updateBlogPost(${index}, 'description', this.value)">${post.description}</textarea>
                    <div class="flex items-center gap-2">
                        <label class="text-xs text-gray-600">Category:</label>
                        <input type="text" class="px-2 py-1 border border-gray-200 rounded text-sm" value="${post.category}" onchange="updateBlogPost(${index}, 'category', this.value)">
                    </div>
                </div>
            `).join('')
        }

        window.addTestimonial = function() {
            const testimonials = currentContent.testimonials || []
            testimonials.push({ customerName: 'New Customer', reviewText: 'Amazing products and excellent service!', rating: 5 })
            currentContent.testimonials = testimonials
            loadTestimonials()
        }

        window.updateTestimonial = function(index, field, value) {
            if (!currentContent.testimonials) currentContent.testimonials = []
            currentContent.testimonials[index][field] = value
        }

        window.removeTestimonial = function(index) {
            if (!currentContent.testimonials) return
            currentContent.testimonials.splice(index, 1)
            loadTestimonials()
        }

        window.addBlogPost = function() {
            const blogPosts = currentContent.blogStories || []
            blogPosts.push({ title: 'New Blog Post', description: 'Write an engaging description about Nepalese craftsmanship.', category: 'Story' })
            currentContent.blogStories = blogPosts
            loadBlogPosts()
        }

        window.updateBlogPost = function(index, field, value) {
            if (!currentContent.blogStories) currentContent.blogStories = []
            currentContent.blogStories[index][field] = value
        }

        window.removeBlogPost = function(index) {
            if (!currentContent.blogStories) return
            currentContent.blogStories.splice(index, 1)
            loadBlogPosts()
        }

        window.togglePreview = function() {
            const panel = document.getElementById('preview-panel')
            panel.classList.toggle('hidden')
        }

        window.saveChanges = async function() {
            if (!currentSection) {
                showError('Please select a section to edit first')
                return
            }

            const saveBtn = document.getElementById('save-btn')
            const originalText = saveBtn.innerHTML
            saveBtn.innerHTML = '<span class="animate-pulse">üíæ Saving...</span>'
            saveBtn.disabled = true

            try {
                // Collect data based on current section
                let sectionData = {}

                switch(currentSection) {
                    case 'hero':
                        sectionData = {
                            title: document.getElementById('hero-title').value,
                            subtitle: document.getElementById('hero-subtitle').value,
                            buttonText: document.getElementById('hero-button').value
                        }
                        break

                    case 'stats':
                        sectionData = {
                            happyCustomers: parseInt(document.getElementById('stat-customers').value),
                            productsSold: parseInt(document.getElementById('stat-products').value),
                            yearsInBusiness: parseInt(document.getElementById('stat-years').value),
                            averageRating: document.getElementById('stat-rating').value
                        }
                        break

                    case 'seo':
                        sectionData = {
                            metaTitle: document.getElementById('seo-title').value,
                            metaDescription: document.getElementById('seo-description').value,
                            keywords: document.getElementById('seo-keywords').value
                        }
                        break

                    case 'why-choose-us':
                        sectionData = currentContent.whyChooseUs || {}
                        break

                    case 'testimonials':
                        sectionData = currentContent.testimonials || []
                        break

                    case 'blog':
                        sectionData = currentContent.blogStories || []
                        break
                }

                currentContent[currentSection] = sectionData

                // Save to localStorage
                localStorage.setItem('site_content', JSON.stringify(currentContent))

                // Show exactly what was saved
                const savedStats = currentContent.stats
                const message = `‚úÖ SAVED!\n\nStats that were saved:\n` +
                    `Happy Customers: ${savedStats?.happyCustomers || 'not set'}\n` +
                    `Products Sold: ${savedStats?.productsSold || 'not set'}\n` +
                    `Years in Business: ${savedStats?.yearsInBusiness || 'not set'}\n` +
                    `Average Rating: ${savedStats?.averageRating || 'not set'}\n\n` +
                    `Now open the homepage in a NEW tab to see changes!`

                alert(message)

                console.log('Saved to localStorage:', currentContent)
                showSuccess()

            } catch (error) {
                console.error('Save error:', error)
                showError('Failed to save changes: ' + error.message)
            } finally {
                saveBtn.innerHTML = originalText
                saveBtn.disabled = false
            }
        }

        function showSuccess() {
            const el = document.getElementById('success-message')
            el.classList.remove('hidden')
            setTimeout(() => el.classList.add('hidden'), 3000)
        }

        function showError(message) {
            const el = document.getElementById('error-message')
            const textEl = document.getElementById('error-text')
            textEl.textContent = message
            el.classList.remove('hidden')
            setTimeout(() => el.classList.add('hidden'), 5000)
        }

        window.logout = async function() {
            await supabase.auth.signOut()
            window.location.href = 'login.html'
        }

        window.testLocalStorage = function() {
            const data = localStorage.getItem('site_content')
            if (data) {
                const parsed = JSON.parse(data)
                alert('‚úÖ localStorage working!\n\nStats data:\n' +
                      `Happy Customers: ${parsed.stats?.happyCustomers || 'not set'}\n` +
                      `Products Sold: ${parsed.stats?.productsSold || 'not set'}\n` +
                      `Years in Business: ${parsed.stats?.yearsInBusiness || 'not set'}\n` +
                      `Average Rating: ${parsed.stats?.averageRating || 'not set'}`)
            } else {
                alert('‚ùå No data in localStorage')
            }
        }

        window.clearLocalStorage = function() {
            if (confirm('Are you sure you want to clear all saved content?')) {
                localStorage.removeItem('site_content')
                currentContent = {}
                alert('‚úÖ localStorage cleared. Page will reload.')
                location.reload()
            }
        }

        window.openHomepage = function() {
            // Open homepage in new tab with cache-busting
            window.open('../index.html?t=' + Date.now(), '_blank')
        }

        // Direct test function
        window.runDirectTest = function() {
            // Step 1: Save test data to localStorage
            const testData = {
                stats: {
                    happyCustomers: 77,
                    productsSold: 888,
                    yearsInBusiness: 25,
                    averageRating: '4.9'
                }
            };
            localStorage.setItem('site_content', JSON.stringify(testData));

            // Step 2: Verify saved
            const saved = localStorage.getItem('site_content');
            alert('Step 1: Data saved to localStorage:\n' + saved);

            // Step 3: Open homepage
            alert('Step 2: Opening homepage in new tab.\n\nPress F12 to open console and look for:\n"=== updateStatsSection START ==="');
            window.open('../index.html?t=' + Date.now(), '_blank');
        }

        // Initialize
        verifyAuth()
    </script>
</body>

</html>